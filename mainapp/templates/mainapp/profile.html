{% extends "mainapp/base.html" %}

{% block content %}
<h3 class="mt-3 mb-3 text-center">Заказы пользователя {{request.user.username}}</h3>
{% if not orders.count %}
<div class="col-md-12" style="margin-top: 300px; margin-bottom: 300px">
	<h3>У вас нет заказов. <a href="{% url 'home_page' %}">Сделать покупки!</a></h3>
</div>
{% else %}
<div class="col-md-15" style="margin-top: 150px; margin-bottom: 300px">
	<table class="table">
		<thead>
			<th scope="col">Номер заказа</th>
			<th scope="col">Статус</th>
			<th scope="col">Товар</th>
			<th scope="col">Дополнительно</th>
		</thead>
		<tbody>
			{% for order in orders  %}
			<tr>
				<th class="row" >Заказ № {{order.id}}</th>
				<td>{{ order.get_status_display }}</td>
				<td>
					<ul>
						{% for item in order.cart.products.all %}
							<li>{{item.product.title}} X {{item.qty}} шт.
							</li>
						{% endfor %}
					</ul>
				</td>
				<td>
					<button class="btn btn-info" data-toggle="modal" data-target="#exampleModal-{{order.id}}">Подробнее</button>
					<div class="modal fade" id="exampleModal-{{order.id}}" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
						<div class="modal-dialog modal-xl">
							<div class="modal-content">
								<div class="modal-header">
									<h5 class="modal-title" id="exampleModalLabel">Детализация заказа</h5>
									<button type="button" class="close" data-dismiss="modal" aria-label="Close">
										<span aria-hidden="true">&times;</span>
									</button>
								</div>
								<div class="modal-body">
									<h4 class="text-centr">Товар</h4>
									<table class="table">
									  <thead>
									    <tr>
									      <th scope="col">Наименование</th>
									      <th scope="col">Изображение</th>
									      <th scope="col">Цена</th>
									      <th scope="col">Кол-во</th>
									      <th scope="col">Общая цена</th>
									      <th scope="col">Дата выдачи</th>
									    </tr>
									  </thead>
									  <tbody>
									  	{% for item in order.cart.products.all %}
										    <tr>
										      <th scope="row">{{item.product.title}}</th>
										      <td class="w-25"><img class="img-fluid" src="{{item.product.image.url}}"></td>
										      <td>{{item.product.price}} руб.</td>
										      <th scope="row">{{ item.qty }}</th>
										      <td><b>{{ item.final_price }} руб.</b></td>
										      
										    </tr>
									    {% endfor %}
									     <tr>
									      <td colspan="2"></td>
									      <td>Итого:</td>
									      <td>{{ order.cart.total_products }}</td>
									      <td><b>{{ order.cart.final_price }} руб.</b></td>
									      <th scope="row">{{order.order_date}}</th>
									    </tr>
  									  </tbody>
									</table>
									<hr>
									<h4 class="text-center">Дополнительная информация</h4>
									<p>Имя: {{order.first_name}}</p>
									<p>Фамилия: {{order.last_name}}</p>
									<p>Телефон: {{order.phone}}</p>
									<p>Адрес: {{order.address}}</p>

								</div>
								<div class="modal-footer">
									<button type="button" class="btn btn-secondary" data-dismiss="modal">Закрыть</button>
									
								</div>
							</div>
						</div>
					</div>	
				</td>
			</tr>
			{% endfor %}
		</tbody>			
	</table>
</div>
{% endif %}
{% endblock content %}